(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const n of o.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&i(n)}).observe(document,{childList:!0,subtree:!0});function e(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(s){if(s.ep)return;s.ep=!0;const o=e(s);fetch(s.href,o)}})();const v=["#2E3539","#00FFFF","#FF69B4","#32CD32","#FFA500","#ADD8E6"];let c=0,_=20;const f=document.createElement("div");f.id="menu";document.body.appendChild(f);const p=document.createElement("div");p.id="resume";p.innerHTML="RESUME";p.classList.add("menu-item");p.classList.add("choice");f.appendChild(p);p.onclick=()=>{A()};const T=document.createElement("div");T.id="restart";T.innerHTML="RESTART";T.classList.add("menu-item");T.classList.add("choice");f.appendChild(T);const g=document.createElement("div");g.id="restart";g.innerHTML="SIZE: 20";g.classList.add("menu-item");g.classList.add("choice");f.appendChild(g);let w=[p,T,g],b=[];b.push(()=>{A()});function M(l,t){A(),b.push(()=>{l.restart();for(const e of t)e.reset();A()}),T.onclick=b[1],b.push(()=>{l.n=_,l.m=_}),g.onclick=b[2]}function I(){for(const l of w)l.classList.remove("selected");w[c].classList.add("selected")}function P(){c-=1,c<0&&(c=0),I()}function U(){c==2&&(_++,g.innerHTML=`SIZE: ${_}`)}function H(){c==2&&(_--,g.innerHTML=`SIZE: ${_}`)}function N(){c+=1,c>=w.length&&(c=w.length-1),I()}function O(){c==0?A():c==1&&b[1]()}function B(){return f.style.display=="block"}function C(){f.style.display="block"}function A(){f.style.display="none"}const k={RC_BOTTOM:"RC_BOTTOM",RC_RIGHT:"RC_RIGHT",RC_LEFT:"RC_LEFT",RC_TOP:"RC_TOP",BUMPER_LEFT:"BUMPER_LEFT",BUMPER_RIGHT:"BUMPER_RIGHT",TRIGGER_LEFT:"TRIGGER_LEFT",TRIGGER_RIGHT:"TRIGGER_RIGHT",CC_LEFT:"CC_LEFT",CC_RIGHT:"CC_RIGHT",THUMBSTICK_LEFT:"THUMBSTICK_LEFT",THUMBSTICK_RIGHT:"THUMBSTICK_RIGHT",LC_BOTTOM:"LC_BOTTOM",LC_RIGHT:"LC_RIGHT",LC_LEFT:"LC_LEFT",LC_TOP:"LC_TOP",CC_CENTER:"CC_CENTER"},G={RC_BOTTOM:0,RC_RIGHT:1,RC_LEFT:2,RC_TOP:3,BUMPER_LEFT:4,BUMPER_RIGHT:5,TRIGGER_LEFT:6,TRIGGER_RIGHT:7,CC_LEFT:8,CC_RIGHT:9,THUMBSTICK_LEFT:10,THUMBSTICK_RIGHT:11,LC_BOTTOM:12,LC_RIGHT:13,LC_LEFT:14,LC_TOP:15,CC_CENTER:16},q={THUMBSTICK_LEFT_X:"THUMBSTICK_LEFT_X",THUMBSTICK_LEFT_Y:"THUMBSTICK_LEFT_Y",THUMBSTICK_RIGHT_X:"THUMBSTICK_RIGHT_X",THUMBSTICK_RIGHT_Y:"THUMBSTICK_RIGHT_Y"},F={THUMBSTICK_LEFT_X:0,THUMBSTICK_LEFT_Y:1,THUMBSTICK_RIGHT_X:2,THUMBSTICK_RIGHT_Y:3},K={TRIGGER:"TRIGGER",SQUEEZE:"SQUEEZE",TOUCHPAD:"TOUCHPAD",THUMBSTICK:"THUMBSTICK",BUTTON_1:"BUTTON_1",BUTTON_2:"BUTTON_2"},X={TRIGGER:0,SQUEEZE:1,TOUCHPAD:2,THUMBSTICK:3,BUTTON_1:4,BUTTON_2:5},z={TOUCHPAD_X:"TOUCHPAD_X",TOUCHPAD_Y:"TOUCHPAD_Y",THUMBSTICK_X:"THUMBSTICK_X",THUMBSTICK_Y:"THUMBSTICK_Y"},Z={TOUCHPAD_X:0,TOUCHPAD_Y:1,THUMBSTICK_X:2,THUMBSTICK_Y:3};class Y{constructor(t,e={}){var i,s,o;this._buttons=[],this._gamepad=t,this._buttonPressValueMin=(i=e.buttonPressValueMin)!==null&&i!==void 0?i:0,this._buttonPressValueMax=(s=e.buttonPressValueMax)!==null&&s!==void 0?s:1,this._buttonClickThreshold=(o=e.buttonClickThreshold)!==null&&o!==void 0?o:.9;for(let n=0;n<this._gamepad.buttons.length;n++)this._buttons[n]={currFrame:{value:0,touched:!1},prevFrame:{value:0,touched:!1},pressedSince:0}}update(){for(let t=0;t<this._gamepad.buttons.length;t++)this._buttons[t].prevFrame=this._buttons[t].currFrame,this._buttons[t].currFrame={value:this._gamepad.buttons[t].value,touched:this._gamepad.buttons[t].touched}}get gamepad(){return this._gamepad}getButtonIdx(t){const e=this._gamepad.mapping=="standard"?G[t]:this._gamepad.mapping=="xr-standard"?X[t]:null;if(e==null)throw`Button "${t}" does not exist in layout "${this._gamepad.mapping}"`;return e}getAxisIdx(t){const e=this._gamepad.mapping=="standard"?F[t]:this._gamepad.mapping=="xr-standard"?Z[t]:null;if(e==null)throw`Axis "${t}" does not exist in layout "${this._gamepad.mapping}"`;return e}getButtonValueByIndex(t){return this._buttons[t]?this._buttons[t].currFrame.value:0}getButtonValue(t){const e=this.getButtonIdx(t);return this.getButtonValueByIndex(e)}getButtonByIndex(t){return this._buttons[t]?this._buttons[t].currFrame.value>this._buttonPressValueMin:!1}getButton(t){const e=this.getButtonIdx(t);return this.getButtonByIndex(e)}getButtonDownByIndex(t){return this._buttons[t]?this._buttons[t].prevFrame.value<=this._buttonPressValueMin&&this._buttons[t].currFrame.value>this._buttonPressValueMin:!1}getButtonDown(t){const e=this.getButtonIdx(t);return this.getButtonDownByIndex(e)}getButtonUpByIndex(t){return this._buttons[t]?this._buttons[t].prevFrame.value>=this._buttonPressValueMax&&this._buttons[t].currFrame.value<this._buttonPressValueMax:!1}getButtonUp(t){const e=this.getButtonIdx(t);return this.getButtonUpByIndex(e)}getButtonClickByIndex(t){return this._buttons[t]?this._buttons[t].prevFrame.value<=this._buttonClickThreshold&&this._buttons[t].currFrame.value>this._buttonClickThreshold:!1}getButtonClick(t){const e=this.getButtonIdx(t);return this.getButtonClickByIndex(e)}getAxisByIndex(t){return this._gamepad.axes[t]}getAxis(t){const e=this.getAxisIdx(t);return this.getAxisByIndex(e)}get2DInputAngle(t){const e=this.getAxis(t+"_X"),i=this.getAxis(t+"_Y");if(e==null||i==null||e==0&&i==0)return NaN;let s=Math.atan(e/i);return e>=0?i<0?s*=-1:i>0?s=Math.PI-s:i==0&&(s=Math.PI/2):i<0?s*=-1:i>0?s=-Math.PI-s:i==0&&(s=-Math.PI/2),s}get2DInputValue(t){const e=this.getAxis(t+"_X"),i=this.getAxis(t+"_Y");return Math.sqrt(e*e+i*i)}getHapticActuator(t){const e=this._gamepad.hapticActuators[t];if(e)return e;throw"Requested haptic actuator does not exist in gamepad"}}const u={STANDARD:k,XR_STANDARD:K},D={STANDARD:q,XR_STANDARD:z},L=new Audio;L.src="sounds/holy_grenade.mp3";const S=new Audio;S.src="sounds/click2.wav";const E=new Audio;E.src="sounds/bass_click.wav";class R{constructor(t,e,i,s){this.isBombLoaded=!1,this.name=Math.random().toString(),this.id=s,this.colorNb=s,this.gamepad=t,this.x=100+Math.random()*50,this.y=100+Math.random()*50,this.world=e,this.speed=5,this.points=0,this.nbBombs=3,this.keyUsed="",this.bombZone=document.createElementNS("http://www.w3.org/2000/svg","image"),this.bombZone.setAttribute("href","img/bomb_zone.svg"),this.bombZone.setAttribute("x",this.x.toString()),this.bombZone.setAttribute("y",this.y.toString()),this.bombZone.setAttribute("width",(3*this.world.size).toString()),this.bombZone.setAttribute("height",(3*this.world.size).toString()),this.bombZone.setAttribute("opacity","0"),e.svg.appendChild(this.bombZone),this.svg=document.createElementNS("http://www.w3.org/2000/svg","circle"),this.svg.setAttribute("position","relative"),this.svg.setAttribute("cx",this.x.toString()),this.svg.setAttribute("cy",this.y.toString()),this.svg.setAttribute("z-index","100"),this.svg.setAttribute("r","6"),this.svg.setAttribute("fill",v[this.colorNb]),this.svg.setAttribute("stroke","black"),e.svg.appendChild(this.svg);const o=document.createElement("div");o.classList.add("score"),o.style.backgroundColor=v[this.colorNb],e.scoresDiv.appendChild(o),this.scoreDiv=o;const n=document.createElement("div");n.textContent=this.points.toString(),this.scoreDiv.appendChild(n),this.pointsDiv=n,this.bombDiv=document.createElement("div"),this.bombDivs=[];for(let r=0;r<this.nbBombs;r++){const d=document.createElement("div");d.classList.add("bomb"),this.bombDiv.appendChild(d),this.bombDivs.push(d)}this.scoreDiv.appendChild(this.bombDiv),console.log("new player",this.id)}reset(){this.updatePoints(-this.points);for(let t=0;t<3-this.nbBombs;t++){const e=document.createElement("div");e.classList.add("bomb"),this.bombDiv.appendChild(e),this.bombDivs.push(e)}this.nbBombs=3,typeof this.tile<"u"&&this.tile.svg.remove(),this.tile=void 0,this.x=100+Math.random()*50,this.y=100+Math.random()*50,this.keyUsed="",this.isBombLoaded=!1,this.bombZone.setAttribute("opacity","0")}updatePoints(t){this.points+=t,this.pointsDiv.textContent=this.points.toString()}cancel(){this.isBombLoaded?(this.isBombLoaded=!1,this.bombZone.setAttribute("opacity","0")):typeof this.tile<"u"&&(E.play(),this.tile.svg.remove(),this.tile=void 0,this.updatePoints(-1))}askExplode(){this.nbBombs>0&&(this.bombDivs[this.nbBombs-1].remove(),this.world.destroyBomb(this.x,this.y),this.nbBombs-=1)}put(){if(typeof this.tile>"u"){for(const[t,e]of this.world.tiles)if(e.containsPoint(this.x,this.y)){console.log("Player clicked on tile"),e.colorTile(this.colorNb),e.setOK(this.colorNb),this.tile=e,this.world.removeTile(e.id),this.world.addRandomTile(),this.world.tilesStackGroup.removeChild(e.svg),this.world.selectedTilesGroup.appendChild(e.svg);return}}else{const t=this.world.tryPut(this.tile,this.x,this.y,this.colorNb,this.id);typeof t=="number"&&(this.updatePoints(t),this.tile=void 0)}}rotate(){typeof this.tile<"u"&&(this.tile.rotate(),this.updateTilePos())}flip(){typeof this.tile<"u"&&(this.tile.flip(),this.updateTilePos())}updateTilePos(){if(typeof this.tile<"u"){this.world.canPut(this.tile,this.x,this.y,this.colorNb,this.id)?this.tile.setOK(this.colorNb):this.tile.setBAD(this.colorNb);const[o,n]=this.world.getCoord(this.x,this.y),r=o*this.world.size,d=n*this.world.size;this.tile.svg.setAttribute("x",r.toString()),this.tile.svg.setAttribute("y",d.toString())}const[t,e]=this.world.getCoord(this.x,this.y),i=(t-1)*this.world.size,s=(e-1)*this.world.size;this.bombZone.setAttribute("x",i.toString()),this.bombZone.setAttribute("y",s.toString())}moveUp(t){this.y-t>=0&&(this.y-=t,this.svg.setAttribute("cy",this.y.toString()),this.updateTilePos())}moveDown(t){this.y+t<this.world.size*(this.world.n+1/2)&&(this.y+=t,this.svg.setAttribute("cy",this.y.toString()),this.updateTilePos())}moveLeft(t){this.x-t>=0&&(this.x-=t,this.svg.setAttribute("cx",this.x.toString()),this.updateTilePos())}moveRight(t){this.x+=t,this.svg.setAttribute("cx",this.x.toString()),this.updateTilePos()}checkEvent(){if(typeof this.gamepad<"u"){if(this.gamepad.update(),this.gamepad.getButtonDown(u.STANDARD.TRIGGER_LEFT)&&C(),this.gamepad.getButtonDown(u.STANDARD.RC_BOTTOM)&&(B()?O():this.put()),this.gamepad.getButtonDown(u.STANDARD.RC_TOP)?this.rotate():this.gamepad.getButtonDown(u.STANDARD.BUMPER_LEFT)&&this.flip(),this.gamepad.getButtonDown(u.STANDARD.RC_RIGHT)&&this.cancel(),this.gamepad.getButtonDown(u.STANDARD.RC_LEFT)&&(this.isBombLoaded?(this.askExplode(),this.isBombLoaded=!1,this.bombZone.setAttribute("opacity","0")):this.nbBombs>0&&(this.isBombLoaded=!0,this.bombZone.setAttribute("opacity","0.5"))),this.gamepad.getButtonDown(u.STANDARD.BUMPER_RIGHT)&&C(),B()){this.gamepad.getButtonDown(u.STANDARD.LC_BOTTOM)&&P(),this.gamepad.getButtonDown(u.STANDARD.LC_TOP)&&U(),this.gamepad.getButtonDown(u.STANDARD.LC_LEFT)&&H(),this.gamepad.getButtonDown(u.STANDARD.LC_RIGHT)&&N();return}this.gamepad.getButton(u.STANDARD.LC_BOTTOM)&&this.moveUp(2),this.gamepad.getButton(u.STANDARD.LC_TOP)&&this.moveRight(2),this.gamepad.getButton(u.STANDARD.LC_RIGHT)&&this.moveDown(2),this.gamepad.getButton(u.STANDARD.LC_LEFT)&&this.moveLeft(2);const t=this.gamepad.getAxis(D.STANDARD.THUMBSTICK_LEFT_X);t<-.2&&this.moveLeft(-t*this.speed),t>.2&&this.moveRight(t*this.speed);const e=this.gamepad.getAxis(D.STANDARD.THUMBSTICK_LEFT_Y);e<-.2&&this.moveUp(-e*this.speed),e>.2&&this.moveDown(e*this.speed)}else this.world.keysPressed.has("d")&&this.moveRight(this.speed),this.world.keysPressed.has("q")&&this.moveLeft(this.speed),this.world.keysPressed.has("z")&&this.moveUp(this.speed),this.world.keysPressed.has("s")&&this.moveDown(this.speed),this.world.keysPressed.has(" ")&&this.put(),this.world.keysPressed.has("e")?this.keyUsed==""&&(this.rotate(),this.keyUsed="e"):this.keyUsed=="e"&&(this.keyUsed=""),this.world.keysPressed.has("f")?this.keyUsed==""&&(this.flip(),this.keyUsed="f"):this.keyUsed=="f"&&(this.keyUsed=""),this.world.keysPressed.has("a")?this.keyUsed==""&&(this.cancel(),this.keyUsed="a"):this.keyUsed=="a"&&(this.keyUsed=""),this.world.keysPressed.has("x")?this.keyUsed==""&&(this.keyUsed="x",this.isBombLoaded?(this.askExplode(),this.isBombLoaded=!1,this.bombZone.setAttribute("opacity","0")):this.nbBombs>0&&(this.isBombLoaded=!0,this.bombZone.setAttribute("opacity","0.5"))):this.keyUsed=="x"&&(this.keyUsed="")}}const x=[[[0,0]],[[0,0],[0,1]],[[0,0],[0,1],[1,0]],[[0,0],[0,1],[0,2]],[[0,0],[0,1],[0,2],[0,3]],[[0,0],[0,1],[1,1],[1,2]],[[0,0],[0,1],[1,0],[1,1]],[[0,0],[0,1],[0,2],[1,0]],[[0,0],[0,1],[0,2],[1,1]],[[0,0],[0,1],[0,2],[1,0],[2,0]],[[0,0],[0,1],[0,2],[0,3],[0,4]],[[0,0],[0,1],[0,2],[0,3],[1,1]],[[0,0],[0,1],[0,2],[2,1],[1,1]],[[0,0],[0,1],[0,2],[0,3],[1,0]],[[0,0],[0,1],[0,2],[1,0],[1,1]],[[0,0],[0,1],[1,1],[1,2],[2,1]],[[0,0],[0,1],[1,1],[1,2],[2,2]],[[0,0],[0,1],[1,1],[2,1],[2,2]],[[0,0],[0,1],[1,0],[2,0],[2,1]]],V=60;class y{constructor(t,e,i,s){this.x=e*i,this.y=t*i,this.i=t,this.j=e,this.rect=document.createElementNS("http://www.w3.org/2000/svg","image"),this.rect.setAttribute("href","img/tile_neutral.svg"),this.rect.setAttribute("x",this.x.toString()),this.rect.setAttribute("y",this.y.toString()),this.rect.setAttribute("z-index","-1"),this.rect.setAttribute("width",`${i}`),this.rect.setAttribute("height",`${i}`),this.playerId=0,this.bonus=0,this.bonusImg=document.createElementNS("http://www.w3.org/2000/svg","image"),this.size=i}reset(){this.bonus=0,this.setColor(0),this.bonusImg.remove(),this.playerId=0}getOwner(){return this.playerId}containsPoint(t,e){return t<=this.x+this.size&&this.x<=t&&e<=this.y+this.size&&this.y<=e}setImpossible(t){t==1&&this.rect.setAttribute("href","img/tile_blue_impossible.svg"),t==2&&this.rect.setAttribute("href","img/tile_pink_impossible.svg"),t==3&&this.rect.setAttribute("href","img/tile_green_impossible.svg"),t==4&&this.rect.setAttribute("href","img/tile_orange_impossible.svg")}setColor(t){this.playerId=t,t==1?this.rect.setAttribute("href","img/tile_blue.svg"):t==2?this.rect.setAttribute("href","img/tile_pink.svg"):t==3?this.rect.setAttribute("href","img/tile_green.svg"):t==4?this.rect.setAttribute("href","img/tile_orange.svg"):this.rect.setAttribute("href","img/tile_neutral.svg")}addBonus(t){this.bonus=t,this.bonusImg=document.createElementNS("http://www.w3.org/2000/svg","image"),this.bonusImg.setAttribute("href","img/star2.svg"),this.bonusImg.setAttribute("x",this.x.toString()),this.bonusImg.setAttribute("y",this.y.toString()),this.bonusImg.setAttribute("width",this.size.toString()),this.bonusImg.setAttribute("height",this.size.toString()),this.rect.parentNode.appendChild(this.bonusImg)}animate(t,e){const i=[{fill:t},{fill:e}],s={duration:500,easing:"ease-in-out",iterations:1};this.rect.animate(i,s)}}class ${constructor(t,e,i){this.id=t,this.svg=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.svg.setAttribute("position","relative"),this.svg.setAttribute("width","300"),this.svg.setAttribute("height","300"),this.svg.setAttribute("z-index","-3"),this.pixelsList=e,this.size=i,this.color=0,this.squares=new Array;for(const[s,o]of e){const n=new y(s,o,i,this.color);this.svg.appendChild(n.rect),this.squares.push(n)}}containsPoint(t,e){const i=Number(this.svg.getAttribute("x")),s=Number(this.svg.getAttribute("y"));for(const o of this.squares)if(o.containsPoint(t-i,e-s))return!0;return!1}colorTile(t){this.color=t;for(const e of this.squares)e.setColor(t)}setOK(t){this.color=t;for(const e of this.squares)e.setColor(t)}setBAD(t){this.color=t;for(const e of this.squares)e.setImpossible(t)}flip(){for(const s of this.squares)s.rect.remove();this.squares.splice(0,this.squares.length);const t=new Array;let e=0,i=0;for(const[s,o]of this.pixelsList){const n=s,r=-o;t.push([n,r]),e=Math.min(e,n),i=Math.min(i,r)}this.pixelsList=new Array;for(const[s,o]of t)this.pixelsList.push([-e+s,-i+o]);for(const[s,o]of this.pixelsList){const n=new y(s,o,this.size,0);this.svg.appendChild(n.rect),this.squares.push(n)}this.colorTile(this.color)}rotate(){for(const s of this.squares)s.rect.remove();this.squares.splice(0,this.squares.length);const t=new Array;let e=0,i=0;for(const[s,o]of this.pixelsList)t.push([o,-s]),e=Math.min(e,o),i=Math.min(i,-s);this.pixelsList=new Array;for(const[s,o]of t)this.pixelsList.push([-e+s,-i+o]);for(const[s,o]of this.pixelsList){const n=new y(s,o,this.size,0);this.svg.appendChild(n.rect),this.squares.push(n)}this.colorTile(this.color)}}class j{constructor(t,e,i){this.over=!1,this.size=Math.floor((window.innerHeight-80)/t),this.n=t,this.m=e,this.squares=new Array,this.tiles=new Map,this.tilesStack=new Array,this.scoresDiv=document.createElement("div"),this.scoresDiv.id="scores",document.body.appendChild(this.scoresDiv),this.keysPressed=new Set,this.lastOperation=Date.now(),this.timerDiv=document.createElement("div"),this.timerDiv.id="timer",this.timerDiv.innerHTML="",document.body.appendChild(this.timerDiv),this.svg=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.tilesStackGroup=document.createElementNS("http://www.w3.org/2000/svg","g"),this.selectedTilesGroup=document.createElementNS("http://www.w3.org/2000/svg","g"),this.initSvg();for(let o=0;o<i;o++)this.tilesStack.push(-1),this.addRandomTile();for(let o=0;o<10;o++)this.addRandomBonus();const s=this;setInterval(()=>{s.updateTimer()},1e3)}restart(){this.over=!1,this.lastOperation=Date.now();for(const t of this.squares)t.reset();for(let t=0;t<10;t++)this.addRandomBonus()}updateTimer(){const t=Math.floor((Date.now()-this.lastOperation)/1e3),e=V-t;e<=0?(this.timerDiv.innerHTML="END",this.over=!0):e<10?(S.play(),this.timerDiv.innerHTML=e.toString()):this.timerDiv.innerHTML=""}addRandomBonus(){const t=new Array;for(const i of this.squares)i.bonus==0&&t.push(i);t[Math.floor(Math.random()*t.length)].addBonus(5)}initSvg(){this.svg.setAttribute("position","relative"),this.svg.setAttribute("width",window.innerWidth.toString()),this.svg.setAttribute("height",window.innerHeight.toString()),window.addEventListener("resize",()=>{this.svg.setAttribute("width",window.innerWidth.toString()),this.svg.setAttribute("height",window.innerHeight.toString())});for(let t=0;t<this.n;t++)for(let e=0;e<this.m;e++){const i=new y(t,e,this.size,0);this.squares.push(i),this.svg.appendChild(i.rect)}this.svg.appendChild(this.tilesStackGroup),this.svg.appendChild(this.selectedTilesGroup),document.body.appendChild(this.svg)}getCoord(t,e){return[Math.floor(t/this.size),Math.floor(e/this.size)]}colorSquare(t,e,i){this.squares}addRandomTile(){const t=new $(Math.floor(Math.random()*1e3),x[Math.floor(Math.random()*x.length)],this.size);for(let e=0;e<this.tilesStack.length;e++)if(this.tilesStack[e]==-1){this.tilesStack[e]=t.id;const i=this.n*this.size+this.size*2;t.svg.setAttribute("x",i.toString());const s=30+e*this.size*4;t.svg.setAttribute("y",s.toString()),this.tiles.set(t.id,t),this.tilesStackGroup.appendChild(t.svg)}}isThereStartColor(t){for(const e of this.squares)if(e.getOwner()==t)return!0;return!1}canPut(t,e,i,s,o){if(this.over)return!1;const[n,r]=this.getCoord(e,i),d=this.isThereStartColor(s);console.log(`has start: ${d}`);let m=!1;for(const[a,h]of t.pixelsList){if(!(n+h<this.n&&0<=n+h&&r+a<this.m&&0<=r+a))return console.log("out of grid"),!1;if(this.squares[n+h+this.m*(r+a)].playerId!=0)return console.log(`square ${n+h} ${r+a} already controlled by `,this.squares[n+h+this.m*(r+a)].playerId),!1;if(m==!1&&(n+h+1<this.n&&r+a+1<this.m&&this.squares[n+h+1+this.m*(r+a+1)].getOwner()==o&&(m=!0),n+h-1>=0&&r+a+1<this.m&&this.squares[n+h-1+this.m*(r+a+1)].getOwner()==o&&(m=!0),n+h-1>=0&&r+a-1>=0&&this.squares[n+h-1+this.m*(r+a-1)].getOwner()==o&&(m=!0),n+h+1<this.n&&r+a-1>=0&&this.squares[n+h+1+this.m*(r+a-1)].getOwner()==o&&(m=!0)),n+h+1<this.n&&this.squares[n+h+1+this.m*(r+a)].playerId==o||n+h-1>=0&&this.squares[n+h-1+this.m*(r+a)].playerId==o||r+a+1<this.m&&this.squares[n+h+this.m*(r+a+1)].playerId==o||r+a-1>=0&&this.squares[n+h+this.m*(r+a-1)].playerId==o)return!1}return!(d&&m==!1)}destroyBomb(t,e){if(this.over)return!1;const[i,s]=this.getCoord(t,e);L.play(),this.lastOperation=Date.now(),this.destroy([[i-1,s-1],[i,s-1],[i+1,s-1],[i-1,s],[i,s],[i+1,s],[i-1,s+1],[i,s+1],[i+1,s+1]])}destroy(t){if(this.over)return!1;for(const[e,i]of t)if(0<=e&&e<=this.n&&0<=i&&i<=this.m){const s=this.squares[e+this.m*i];s.playerId=0,s.setColor(0)}}removeTile(t){this.tiles.delete(t);for(let e=0;e<this.tilesStack.length;e++)this.tilesStack[e]==t&&(this.tilesStack[e]=-1)}tryPut(t,e,i,s,o){if(!this.over&&this.canPut(t,e,i,s,o)){S.play();const[n,r]=this.getCoord(e,i);let d=t.pixelsList.length;for(const[m,a]of t.pixelsList){const h=this.squares[n+a+this.m*(r+m)];d+=h.bonus,h.playerId=o,typeof h.animation<"u"&&(h.animation.cancel(),h.animation=void 0),h.setColor(s),h.animate("gray",v[s])}return this.lastOperation=Date.now(),this.removeTile(t.id),t.svg.remove(),d}}}function W(){const l=new j(20,20,5),t=new Array;let e=!1,i;M(l,t),window.addEventListener("gamepadconnected",o=>{console.log("gamepad connected"),i=new Y(o.gamepad),t.push(new R(i,l,t.length,(1+t.length)%v.length))}),window.addEventListener("keydown",o=>{e==!1&&(console.log("keyboard connected"),e=!0,t.push(new R(void 0,l,t.length,(1+t.length)%v.length))),o.repeat||l.keysPressed.add(o.key.toLowerCase()),o.key=="Escape"&&C()}),window.addEventListener("keyup",o=>{l.keysPressed.delete(o.key.toLowerCase())});function s(){for(const o of t)o.checkEvent()}setInterval(s,16)}W();
